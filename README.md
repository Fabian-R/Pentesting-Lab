# Pentesting Lab

## Objective

I designed this lab to demonstrate a grasp of the penetration testing methodology, including simulating controlled cyberattacks to identify vulnerabilities and assess security posture. By understanding how vulnerabilities are exploited, the lab allows me to demonstrate the ability to identify and implement effective defensive strategies. This could involve system hardening, patching vulnerabilities, or suggesting additional security controls.


### Skills Learned

- Pentesting simulation
- Firewalls Intrusion Detection System (IDS) and Intrusion Prevention System (IPS)
- Vulnerability Assesment

### Tools Used

- Operative System Linux
- OpenVAS
- Metasploit
- EternalBlue
- Netcat


## Victim Creation 

1.	For the creation of the virtual machine, it was decided to create with Windows 7 operating system. In addition to being a server, it was decided to use the Xampp application and Apache running PHP websites.
   
 ![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/61b3a92e-ce1a-44d6-818b-fc09f5660ebe)

*Ref 1: Windows 7 computer running Xampp Server*

## OpenVAS

Vulnerability scanner. Its capabilities include authenticated and unauthenticated testing, various high- and low-level internet and industrial protocols, performance tuning for large-scale scans, and a powerful in-house programming language for implementing any type of vulnerability testing.

1.	We run sudo apt update & sudo apt upgrade. “apt-get update” updates the list of available packages, “apt-get upgrade” updates the packages installed on the system to their latest versions.
2.	We installed OpenVAS with sudo apt install gvm -y 
3.	Later, we run sudo gvm-setup, when OpenVAS completes automatically, it will return a password with which we must enter the graphical interface using the address https://127.0.0.1:9392/login.

![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/35e595e4-386e-46c1-8909-eda1e7f0807f)

*Ref 2: OpenVAS login Screen*

4. Once installed, we will have several tabs within the application to perform a scan, we will look for Configuration > Targets

![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/37947a69-99ec-4126-af5e-38d70987c846)

*Ref 3: Targets menu*

5.	We will create a target according to our requirements, in this case we will scan the network 192.168.0.1/24

![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/1d691e23-5fe4-4907-af70-d842cb311f16)

*Ref 4: Targets creation screen*

7.	From the Scans tab, we'll create a new task

   ![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/801fcfa0-daee-4546-a8fa-e1dec4220ed8)

*Ref 5: Scans creation menu*

9.	Once the scan is finished, we will have access to the following information:
   
      - Results
      - Hosts
      - Ports
      - Applications
      - Operative Systems
      - CVEs
      - Closed CVEs 
      - Errors
      - Among others


8.	In this case, we have found our target with some vulnerabilities such as:
      - Operating System (OS) End of Life (EOL) Detection
      - Microsoft Windows SMB Server Multiple Vulnerabilities-Remote (4013389)
      - TCP Timestamps Information Disclosure
      - ICMP Timestamp Reply Information Disclosure
      - phpinfo() Output Reporting (HTTP)

    ![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/dfb4ef15-ff35-4641-b1d7-3a5c628493ba)

*Ref 6: OpenVAS found vulnerabilities*


## Metasploit

Open-source penetration testing framework created by Rapid7 that enables security professionals to simulate attacks against computer systems, networks, and applications. It provides a variety of tools and modules that can be used to check the security of the target system, identify vulnerabilities, and use them to break into the system.
Users can adjust their experiments to a certain environment or set of goals, expressing flexibility and adaptability.
Within this framework there are several predefined vulnerabilities and payloads and the option to create unique exploits or programs. For this case we will use EternalBlue.

### EternalBlue

Exploit leaked by the Shadow Brokers group on April 14, 2017 that exploits a vulnerability in Microsoft's SMB protocol. Is believed to have been developed by the NSA. It was used in the ransomware attack known as WannaCry in May 2017. 

#### Exploiting a vulnerability

1.	Enter the "msfconsole" command to enter the Metasploit console.
   
   ![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/168fb6e9-7505-456b-b12b-a4685507acf6)

2.	To search for the EternalBlue exploit, enter the "search eternalblue" command.

   ![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/5fe6acfa-ac35-40c4-b406-7a5ed993dfdb)


3.	Enter the command "use exploit/windows/smb/ms17_010_eternalblue" to exploit the MS1701 vulnerability.

   ![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/4ef75be5-dd70-429a-927c-5bdf4d802649)


4.	Execute “show options”

  ![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/d2eb45c0-bb67-4596-92ee-c7699d059264)


5.	With the information found in OpenVas we configured the attack using the following commands:
-	Set lport with the port number to be exploited, in this case it would be "set lport 445"
-	Set rhosts with the victim's IP address "set rhosts 192.168.0.48"

  ![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/4b01e1ba-528c-423f-9323-dc378d096049)

6.	To execute the attack, we will use "exploit."

![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/05f240fc-0248-4f7f-a68f-f44f988517e4)

7.	Once the exploit is executed, we will have access to meterpreter, once connected we can execute commands such as:

   - sysinfo
     
      ![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/a101a7b4-76ec-463a-8c19-31bb98d0639f)

   - ipconfig

      ![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/12adb3b3-c128-4149-b5e6-f3221af31594)

   - execute -f cmd.exe -i -H

      ![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/8fb035ea-31d2-405d-bbf0-151f13f0e23f)
 
8.	Having access to the CMD we can use any command that would be executed in Windows, in this case we will use Netcat to try to connect to another computer and escalate privileges.


### Netcat

A network utility that reads and writes data over network connections using the TCP/IP protocol suite. It can be used for various purposes such as:
- Port Scanning: Check which ports are open on a remote host.
- File Transfer: Transmission of files between systems.
- Network debugging: Inspect and manipulate network traffic.
- Remote Administration: Interact with remote systems.

1.	Having access to the system, we will escalate privileges through netcat, it is important to mention that if the installation files are not on the Windows computer these steps will not work as well as telnet if the service is not running the same thing will happen.
   
2.	In Kali will set up a listen
   
    ![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/8da25490-3138-4738-8b68-361399e9dde9)
   
3.  From the Windows machine that we already have access to, we can connect to our port 4444

    ![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/a48c1bbf-ca0d-4273-b156-917c30092345)


## Network topology

In this case, we can confirm that several hosts are connected to the local network, including 192.168.0.48 (vulnerable host), through which we entered from Kali using Eternal blue. From the CMD connection, we could execute netcat commands that allow us to escalate privileges, even to the Windows Server.

![image](https://github.com/Fabian-R/Pentesting-Lab/assets/169630952/d48074ed-7be9-4418-8b33-5a4cff4f9621)


## Countermeasures to the attack

Firewalls act as gatekeepers to network communications, examining and filtering network traffic to ensure that only authorized and secure traffic passes through.
This process protects the network from unauthorized attempts to gain access, cyberattacks, and malicious code.  In this scenario, the firewalls of the computer 192.168.0.48 were disabled so that it could be scanned by OpenVAS.

Primary Firewall Methods
Firewalls, whether hardware or software, work using three main methods:

1.	Packet Filtering: 
It is an access control mechanism that examines small units of data (packets) according to a predetermined set of rules. Packets that adhere to the ruleset advance to their target system, while the system rejects the rest. Packet filtering firewalls allow the traffic filtering mechanism to be based on elements such as source and destination IP addresses, or even service type.

2.	Proxy Service:
In this case, the proxy firewall acts as an intermediary. Instead of allowing direct communication of data packets between the user and the Internet, the proxy retrieves the data for the user and then relays it, preventing direct access to the system.

3.	Condition Inspection:
Health inspection firewalls track outgoing packets and compare incoming responses to your database of active sessions. Only those that match a valid corresponding outbound packet are approved. 


Firewall Configuration Criteria

Involves defining rules based on specific parameters to control internal and external data exchanges. Configuration criteria include:

1.	IP Addresses:
Every device connected to the internet has a unique identifier called an IP address. These 32-bit numeric addresses usually appear as a series of four decimal numbers. If the firewall recognizes an external IP address as a potential threat or if it appears to access excessive data, it can block all communications from that address.

2.	Domain Names:
Protocols define the rules of communication between two devices or applications. Commonly used protocols include IP, TCP, HTTP, FTP, UDP, ICMP, SMTP, SNMP, and Telnet. Organizations may decide to allow only specific protocols accessible on their network.

3.	Ports:
Servers provide services through port numbers. For example, HTTP, the protocol used by web browsers, generally operates over port 80. Organizations can block or allow traffic based on these port numbers, ensuring tighter control over accessible services.

4.	Specific Words and Phrases:
Advanced solutions can scan packages for certain keywords, blocking any packages that contain flagged terms.

## Results

It's critical to keep systems up-to-date with security patches and software updates to close known vulnerabilities. Implementing firewalls, IDS/IPS systems, and strong authentication helps prevent intrusions and unauthorized access.
In addition, conducting regular security audits and raising staff awareness of cybersecurity practices are key elements in maintaining information security. Limiting privileged access, monitoring network traffic, and segmenting the network are also effective strategies for reducing the attack surface and limiting the impact of potential intrusions.
Finally, implementing host-based intrusion prevention systems and conducting internal penetration testing help identify and fix security weaknesses before they can be exploited by external attackers.
In summary, by adopting these recommendations and following good cybersecurity practices, organizations can significantly strengthen their security posture and mitigate the risk of attacks that could leverage basic tools such as OpenVAS and Metasploit.



